<!DOCTYPE html>  
<html>
<head>
<title>GTA1-like Game</title>
<script src="https://cdn.jsdelivr.net/npm/simplex-noise@2.4.0/simplex-noise.min.js"></script>
<style>
body {
  margin: 0;
  overflow: hidden;
}
canvas {
  display: block;
}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const mapWidth = 2000;
const mapHeight = 1000;
const tileSize = 20; // Increased tile size for zoom effect
const playerSize = 10;
const noiseScale = 0.02;
const noiseScale2 = 0.05;
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const simplex = new SimplexNoise();

const player = {
  x: 0,
  y: 0,
  speed: 2,
};

const keys = {
  ArrowUp: false,
  ArrowDown: false,
  ArrowLeft: false,
  ArrowRight: false,
};

document.addEventListener('keydown', (e) => {
  keys[e.code] = true;
});

document.addEventListener('keyup', (e) => {
  keys[e.code] = false;
});

const textures = {};
const textureSources = {
  water: 'water.png',
  city: 'city.png',
  suburbs: 'suburbs.png',
  grassland: 'grassland.png',
  road: 'road.png'
};

function loadTextures(callback) {
  let loaded = 0;
  const keys = Object.keys(textureSources);
  keys.forEach((key) => {
    const img = new Image();
    img.src = textureSources[key];
    img.onload = () => {
      textures[key] = img;
      loaded++;
      if (loaded === keys.length) {
        callback();
      }
    };
  });
}

function generateMap() {
  const mapData = [];
  for (let y = 0; y < mapHeight / tileSize; y++) {
    const row = [];
    for (let x = 0; x < mapWidth / tileSize; x++) {
      const noiseValue1 = simplex.noise2D(x * noiseScale, y * noiseScale);
      const noiseValue2 = simplex.noise2D(x * noiseScale2, y * noiseScale2) * 0.5;
      const combinedNoise = noiseValue1 + noiseValue2;

      let biome = 'grassland';
      if (combinedNoise < -0.5) {
        biome = 'water';
      } else if (combinedNoise < -0.1) {
        biome = 'suburbs';
      } else if (combinedNoise > 0.9) {
        biome = 'city';
      } else if (combinedNoise > 0.4) {
        biome = 'suburbs';
      }

      row.push({
        noise: combinedNoise,
        biome: biome,
      });
    }
    mapData.push(row);
  }

  // Find a city tile for the player to spawn
  for (let y = 0; y < mapData.length; y++) {
    for (let x = 0; x < mapData[y].length; x++) {
      if (mapData[y][x].biome === 'city') {
        player.x = x * tileSize;
        player.y = y * tileSize;
        return mapData;
      }
    }
  }

  return mapData;
}

const map = generateMap();

function drawMap() {
  const viewWidth = canvas.width / tileSize;
  const viewHeight = canvas.height / tileSize;

  for (let y = 0; y < viewHeight; y++) {
    for (let x = 0; x < viewWidth; x++) {
      const mapX = x + Math.floor(player.x / tileSize) - Math.floor(viewWidth / 2);
      const mapY = y + Math.floor(player.y / tileSize) - Math.floor(viewHeight / 2);

      if (mapX >= 0 && mapX < mapWidth / tileSize && mapY >= 0 && mapY < mapHeight / tileSize) {
        const tile = map[mapY][mapX];
        const texture = textures[tile.biome] || textures.grassland;
        ctx.drawImage(texture, x * tileSize, y * tileSize, tileSize, tileSize);

        // Draw roads if applicable
        if (tile.biome === 'city' || tile.biome === 'suburbs') {
          ctx.drawImage(textures.road, x * tileSize, y * tileSize, tileSize, tileSize);
        }
      }
    }
  }
}

function gameLoop() {
  // Handle player movement
  if (keys.ArrowUp) player.y -= player.speed;
  if (keys.ArrowDown) player.y += player.speed;
  if (keys.ArrowLeft) player.x -= player.speed;
  if (keys.ArrowRight) player.x += player.speed;

  // Keep player within bounds
  player.x = Math.max(playerSize, Math.min(mapWidth - playerSize, player.x));
  player.y = Math.max(playerSize, Math.min(mapHeight - playerSize, player.y));

  // Draw everything
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawMap();

  // Draw player
  ctx.fillStyle = '#ff0000';
  ctx.fillRect(
    canvas.width / 2 - playerSize / 2,
    canvas.height / 2 - playerSize / 2,
    playerSize,
    playerSize
  );

  requestAnimationFrame(gameLoop);
}

loadTextures(gameLoop);
</script>
</body>
</html>
